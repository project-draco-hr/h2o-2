import random
import jenkinsapi
import getpass
from jenkinsapi.jenkins import Jenkins
import re
import os
from os.path import expanduser
import shutil
import logging
logging.basicConfig(filename='python.log', level=logging.INFO)
(username, password) = login()
LOG_DIR = 'sandbox'
clean_sandbox(LOG_DIR)
jenkinsurl = 'http://192.168.1.164:8080'
jobName = 'h2o_master_test'
J = Jenkins(jenkinsurl, username, password)
print J.keys()
print J[jobName]
job = J[jobName]
lgb = job.get_last_good_build()
print lgb.get_revision()
print job.get_config
if (1 == 0):
    from jenkinsapi.api import search_artifact_by_regexp
    artifact_regexp = re.compile('commands.log')
    result = search_artifact_by_regexp(jenkinsurl, jobName, artifact_regexp)
    print repr(result)
print 'last_stable_buildnumber', job.get_last_stable_buildnumber()
print 'last_good_buildnumber', job.get_last_good_buildnumber()
print 'last_failed_buildnumber', job.get_last_failed_buildnumber()
print 'last_buildnumber', job.get_last_buildnumber()
build = job.get_build(job.get_last_good_buildnumber())
print 'build revision', build.get_revision()
af = build.get_artifacts()
dict_af = build.get_artifact_dict()
print 'build get_status', build.get_status()
print 'build name', build.name
print 'build number', build.get_number()
print 'dict_af', dict_af
for (i, a) in enumerate(af):
    print ('Artifact #%s' % i), a.filename, a.build, a.url
    if ('txt' in a.filename):
        print '\n', a.filename, '####################################'
        print '\n', a.url, '####################################'
        a.save(((LOG_DIR + '/') + a.filename))
