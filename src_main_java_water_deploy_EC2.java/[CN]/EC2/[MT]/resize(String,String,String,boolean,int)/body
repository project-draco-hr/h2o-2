{
  AmazonEC2Client ec2=new AmazonEC2Client(H2O.getAWSCredentials());
  ec2.setEndpoint("ec2." + region + ".amazonaws.com");
  DescribeInstancesResult describeInstancesResult=ec2.describeInstances();
  List<Reservation> reservations=describeInstancesResult.getReservations();
  List<Instance> instances=new ArrayList<Instance>();
  for (  Reservation reservation : reservations) {
    for (    Instance instance : reservation.getInstances()) {
      String ip=ip(instance);
      if (ip != null) {
        String name=null;
        if (instance.getTags().size() > 0)         name=instance.getTags().get(0).getValue();
        if (NAME.equals(name))         instances.add(instance);
      }
    }
  }
  System.out.println("Found " + instances.size() + " EC2 instances.");
  if (instances.size() > count) {
    for (int i=0; i < instances.size() - count; i++) {
    }
  }
 else   if (instances.size() < count) {
    int launchCount=count - instances.size();
    System.out.println("Creating " + launchCount + " EC2 instances.");
    if (confirm) {
      System.out.println("Please confirm [y/n]");
      String s=Utils.readConsole();
      if (s == null || !s.equalsIgnoreCase("y"))       throw new RuntimeException("Aborted");
    }
    RunInstancesRequest request=new RunInstancesRequest();
    request.withInstanceType(type);
    if (region.startsWith("us-east-1"))     request.withImageId("ami-fc75ee95");
 else     if (region.startsWith("us-west-1"))     request.withImageId("ami-64d1fc21");
 else     if (region.startsWith("us-west-2"))     request.withImageId("ami-52bf2b62");
 else     if (region.startsWith("eu-west-1"))     request.withImageId("ami-5e93992a");
 else     if (region.startsWith("ap-southeast-1"))     request.withImageId("ami-ac9ed2fe");
 else     if (region.startsWith("ap-southeast-2"))     request.withImageId("ami-283eaf12");
 else     if (region.startsWith("ap-northeast-1"))     request.withImageId("ami-153fbf14");
 else     if (region.startsWith("sa-east-1"))     request.withImageId("ami-db6bb0c6");
    request.withMinCount(launchCount).withMaxCount(launchCount);
    request.withSecurityGroupIds(secg);
    request.withUserData(new String(Base64.encodeBase64(cloudConfig().getBytes())));
    RunInstancesResult runInstances=ec2.runInstances(request);
    ArrayList<String> ids=new ArrayList<String>();
    for (    Instance instance : runInstances.getReservation().getInstances())     ids.add(instance.getInstanceId());
    List<Instance> created=wait(ec2,ids,secg);
    System.out.println("Created " + created.size() + " EC2 instances.");
    instances.addAll(created);
  }
  String[] pub=new String[instances.size()];
  String[] prv=new String[instances.size()];
  for (int i=0; i < instances.size(); i++) {
    pub[i]=instances.get(i).getPublicIpAddress();
    prv[i]=instances.get(i).getPrivateIpAddress();
  }
  System.out.println("EC2 public IPs: " + Utils.join(' ',pub));
  System.out.println("EC2 private IPs: " + Utils.join(' ',prv));
  return new Cloud(pub,prv);
}
