{
  cmp.addToPendingCount(1);
  new TAtomic<GLMModel>(cmp){
    @Override public GLMModel atomic(    GLMModel old){
      int bestId=0;
      final boolean xval=old.submodels[0].xvalidation != null;
      GLMValidation bestVal=xval ? old.submodels[0].xvalidation : old.submodels[0].validation;
      for (int i=1; i < old.submodels.length; ++i) {
        GLMValidation val=xval ? old.submodels[i].xvalidation : old.submodels[i].validation;
        if ((useAuc && val.auc > bestVal.auc) || (xval && val.residual_deviance < bestVal.residual_deviance) || (((bestVal.residual_deviance - val.residual_deviance) / val.null_deviance) >= 0.01)) {
          bestVal=val;
          bestId=i;
        }
      }
      old.best_lambda_idx=bestId;
      Submodel sm=old.submodels[bestId];
      double[] beta=MemoryManager.malloc8d(old.coefficients_names.length);
      for (int i=0; i < sm.beta.length; ++i)       beta[sm.idxs[i]]=sm.beta[i];
      old.global_beta=beta;
      return old;
    }
  }
.fork(modelKey);
}
