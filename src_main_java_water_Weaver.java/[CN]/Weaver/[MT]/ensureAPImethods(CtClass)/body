{
  CtField ctfs[]=cc.getDeclaredFields();
  boolean api=false;
  for (  CtField ctf : ctfs)   if (ctf.getName().equals("API_WEAVER"))   api=true;
  if (api == false)   return;
  CtField fielddoc=null;
  CtField getdoc=null;
  make_body(cc,ctfs,false,"public water.AutoBuffer writeJSON(water.AutoBuffer ab) {\n  ab.put1('{');\n","  super.writeJSON(ab);\n","  ab.putJSON%z(\"%s\",%s)","  ab.putEnumJSON(%s)","  ab.putJSON%z(%s)",".put1(',');\n",";\n  return ab.put1('}');\n}",new FieldFilter(){
    boolean filter(    CtField ctf) throws NotFoundException {
      return !ctf.getType().subclassOf(_arg);
    }
  }
);
  StringBuilder sb=new StringBuilder();
  sb.append("new water.api.DocGen$FieldDoc[] {");
  boolean first=true;
  for (  CtField ctf : ctfs) {
    int mods=ctf.getModifiers();
    if (javassist.Modifier.isTransient(mods) || javassist.Modifier.isStatic(mods)) {
      if (ctf.getName().equals("DOC_FIELDS"))       fielddoc=ctf;
      if (ctf.getName().equals("DOC_GET"))       getdoc=ctf;
      continue;
    }
    String name=ctf.getName();
    Object[] as;
    try {
      as=ctf.getAnnotations();
    }
 catch (    ClassNotFoundException ex) {
      throw new RuntimeException(ex);
    }
    Weave w=null;
    for (    Object a : as) {
      if (a instanceof Weave)       w=(Weave)a;
    }
    if (w == null)     throw new CannotCompileException("Class " + cc.getName() + " has non-transient field '"+ name+ "' without a Weave annotation");
    String help=w.help();
    int min=w.minVersion();
    int max=w.maxVersion();
    if (min < 1 || min > 1000000)     throw new CannotCompileException("Found field '" + name + "' but MinVer < 1 or MinVer > 1000000");
    if (max < min || (max > 1000000 && max != Integer.MAX_VALUE))     throw new CannotCompileException("Found field '" + name + "' but MaxVer < "+ min+ " or MaxVer > 1000000");
    if (first)     first=false;
 else     sb.append(",");
    sb.append("new water.api.DocGen$FieldDoc(\"" + name + "\",\""+ help+ "\","+ min+ ","+ max+ ","+ ctf.getType().getName()+ ".class)");
  }
  sb.append("}");
  if (fielddoc == null)   throw new CannotCompileException("Did not find static final DocGen.FieldDoc[] DOC_FIELDS field;");
  if (!fielddoc.getType().isArray() || fielddoc.getType().getComponentType() != _fielddoc)   throw new CannotCompileException("DOC_FIELDS not declared static final DocGen.FieldDoc[];");
  cc.removeField(fielddoc);
  cc.addField(fielddoc,CtField.Initializer.byExpr(sb.toString()));
  cc.addMethod(CtNewMethod.make("  public water.api.DocGen$FieldDoc[] toDocField() { return DOC_FIELDS; }",cc));
  if (getdoc != null)   cc.addMethod(CtNewMethod.make("  public String toDocGET() { return DOC_GET; }",cc));
}
