def test_import_nflx_parse_loop(self):
    print 'Using the -.gz files from hdfs'
    csvFilename = 'file_10.dat.gz'
    csvFilepattern = 'file_1[0-9].dat.gz'
    trialMax = 2
    for tryHeap in [24]:
        print '\n', tryHeap, 'GB heap, 1 jvm per host, import 192.168.1.176 hdfs, then parse'
        h2o_hosts.build_cloud_with_hosts(node_count=1, java_heap_GB=tryHeap, use_hdfs=True, hdfs_name_node='192.168.1.176', hdfs_version='cdh3u5')
        h2o.nodes[0].sandbox_ignore_errors = True
        URI = (('hdfs://' + h2o.nodes[0].hdfs_name_node) + '/datasets/manyfiles-nflx-gz')
        hdfsKey = ((URI + '/') + csvFilepattern)
        timeoutSecs = 500
        for trial in range(trialMax):
            importHdfsResult = h2o.nodes[0].import_hdfs(URI)
            hdfsFullList = importHdfsResult['succeeded']
            for k in hdfsFullList:
                key = k['key']
                if (('nflx' in key) and ('file_1.dat.gz' in key)):
                    print "example file we'll use:", key
            self.assertGreater(len(hdfsFullList), 8, "Didn't see more than 8 files in hdfs?")
            key2 = (((csvFilename + '_') + str(trial)) + '.hex')
            print 'Loading hdfs key: ', hdfsKey
            start = time.time()
            parseKey = h2o.nodes[0].parse(hdfsKey, key2, timeoutSecs=timeoutSecs, retryDelaySecs=10, pollTimeoutSecs=60)
            elapsed = (time.time() - start)
            print hdfsKey, 'parse time:', parseKey['response']['time']
            print 'parse result:', parseKey['destination_key']
            print 'Parse #', trial, 'completed in', ('%6.2f' % elapsed), 'seconds.', ('%d pct. of timeout' % ((elapsed * 100) / timeoutSecs))
            print 'Deleting key in H2O so we get it from hdfs', 'Otherwise it would just parse the cached key.'
            storeView = h2o.nodes[0].store_view()
            for k in hdfsFullList:
                deleteKey = k['key']
                if ((csvFilename in deleteKey) and (not ('.hex' in key))):
                    print 'Removing', deleteKey
                    removeKeyResult = h2o.nodes[0].remove_key(key=deleteKey)
        h2o.tear_down_cloud()
        time.sleep(5)
