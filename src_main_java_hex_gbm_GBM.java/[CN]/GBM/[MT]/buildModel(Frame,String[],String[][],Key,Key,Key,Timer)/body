{
  GBMModel model=new GBMModel(outputKey,dataKey,testKey,names,domains,ntrees,max_depth,min_rows,nbins,learn_rate);
  model.delete_and_lock(self());
  new ExcludeNAResponse().doAll(fr);
  int tid;
  DTree[] ktrees=null;
  TreeStats tstats=new TreeStats();
  for (tid=0; tid < ntrees; tid++) {
    model=doScoring(model,outputKey,fr,ktrees,tid,tstats,false,false,false);
    new ComputeProb().doAll(fr);
    new ComputeRes().doAll(fr);
    ktrees=buildNextKTrees(fr);
    Log.info(Sys.GBM__,(tid + 1) + ". tree was built.");
    if (cancelled())     break;
    tstats.updateBy(ktrees);
  }
  model=doScoring(model,outputKey,fr,ktrees,tid,tstats,true,false,false);
  model.unlock(self());
  cleanUp(fr,t_build);
}
