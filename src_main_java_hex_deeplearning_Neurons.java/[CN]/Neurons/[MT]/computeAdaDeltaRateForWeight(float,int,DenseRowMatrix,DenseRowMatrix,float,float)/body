{
  final float grad2=grad * grad;
  ada_g.raw()[w]=ada_g.raw()[w] * rho;
  ada_g.raw()[w]+=(1f - rho) * grad2;
  final float RMS_dx=Utils.approxSqrt(ada_dx.raw()[w] + eps);
  final float invRMS_g=Utils.approxInvSqrt(ada_g.raw()[w] + eps);
  float rate=RMS_dx * invRMS_g;
  ada_dx.raw()[w]=rho * ada_dx.raw()[w] + (1f - rho) * rate * rate* grad2;
  return rate;
}
