{
  gemv(_a,_w,_previous._a,_b,null);
  final float max=Utils.maxValue(_a);
  float scale=0;
  for (int o=0; o < _a.length; o++) {
    _a[o]=(float)Math.exp(_a[o] - max);
    scale+=_a[o];
  }
  for (int o=0; o < _a.length; o++) {
    if (Float.isNaN(_a[o]))     throw new RuntimeException("Numerical instability, predicted NaN.");
    _a[o]/=scale;
  }
}
