def build_cloud(node_count=2, base_port=54321, hosts=None, timeoutSecs=30, retryDelaySecs=1, cleanup=True, rand_shuffle=True, conservative=False, create_json=False, **kwargs):
    clean_sandbox()
    check_h2o_version()
    if kwargs.setdefault('enable_benchmark_log', False):
        setup_benchmark_log()
    ports_per_node = 2
    nodeList = []
    try:
        totalNodes = 0
        portList = [(base_port + (ports_per_node * i)) for i in range(node_count)]
        if (hosts is None):
            write_flatfile(node_count=node_count, base_port=base_port)
            hostCount = 1
            if rand_shuffle:
                random.shuffle(portList)
            for p in portList:
                verboseprint('psutil starting node', i)
                newNode = LocalH2O(port=p, node_id=totalNodes, **kwargs)
                nodeList.append(newNode)
                totalNodes += 1
        else:
            hostCount = len(hosts)
            hostPortList = []
            for h in hosts:
                for port in portList:
                    hostPortList.append((h, port))
            if rand_shuffle:
                random.shuffle(hostPortList)
            for (h, p) in hostPortList:
                verboseprint('ssh starting node', totalNodes, 'via', h)
                newNode = h.remote_h2o(port=p, node_id=totalNodes, **kwargs)
                nodeList.append(newNode)
                totalNodes += 1
        verboseprint('Attempting Cloud stabilize of', totalNodes, 'nodes on', hostCount, 'hosts')
        start = time.time()
        stabilize_cloud(nodeList[0], len(nodeList), timeoutSecs=timeoutSecs, retryDelaySecs=retryDelaySecs)
        verboseprint(len(nodeList), 'Last added node stabilized in ', (time.time() - start), ' secs')
        verboseprint(('Built cloud: %d nodes on %d hosts, in %d s' % (len(nodeList), hostCount, (time.time() - start))))
        if conservative:
            for n in nodeList:
                stabilize_cloud(n, len(nodeList), timeoutSecs=timeoutSecs)
        else:
            pass
        check_sandbox_for_errors()
    except:
        if cleanup:
            for n in nodeList:
                n.terminate()
        else:
            nodes[:] = nodeList
        check_sandbox_for_errors()
        raise
    nodes[:] = nodeList
    print len(nodeList), 'total jvms in H2O cloud'
    if create_json:
        p = h2o_util.json_repr(nodes)
        with open('h2o-nodes.json', 'w+') as f:
            f.write(json.dumps(p, indent=4))
    return nodeList
