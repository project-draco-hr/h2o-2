{
  File file1=TestUtil.find_test_file("smalldata/gbm_test/ecology_model.csv");
  if (file1 == null)   return;
  Key fkey1=NFSFileVec.make(file1);
  Key dest1=Key.make("train.hex");
  File file2=TestUtil.find_test_file("smalldata/gbm_test/ecology_eval.csv");
  Key fkey2=NFSFileVec.make(file2);
  Key dest2=Key.make("test.hex");
  GBM gbm=null;
  GBM.GBMModel gbmmodel=null;
  Frame ftest=null, fpreds=null;
  try {
    gbm=new GBM();
    Frame fr=ParseDataset2.parse(dest1,new Key[]{fkey1});
    UKV.remove(fr.remove("Site")._key);
    gbm.response=fr.vecs()[fr.find("Angaus")];
    gbm.source=fr;
    gbm.ntrees=5;
    gbm.max_depth=10;
    gbm.learn_rate=0.2f;
    gbm.min_rows=10;
    gbm.nbins=100;
    gbm.invoke();
    gbmmodel=UKV.get(gbm.dest());
    ftest=ParseDataset2.parse(dest2,new Key[]{fkey2});
    fpreds=gbm.score(ftest);
    ConfusionMatrix CM=new ConfusionMatrix();
    CM.actual=ftest;
    CM.vactual=ftest.vecs()[ftest.find("Angaus")];
    CM.predict=fpreds;
    CM.vpredict=fpreds.vecs()[fpreds.find("predict")];
    CM.serve();
    long cm[][]=CM.cm;
    long acts[]=new long[cm.length];
    long preds[]=new long[cm[0].length];
    for (int a=0; a < cm.length; a++) {
      long sum=0;
      for (int p=0; p < cm[a].length; p++) {
        sum+=cm[a][p];
        preds[p]+=cm[a][p];
      }
      acts[a]=sum;
    }
    String[] tfs=new String[]{"False","True","NA"};
    String adomain[]=ConfusionMatrix.show(acts,tfs);
    String pdomain[]=ConfusionMatrix.show(preds,tfs);
    StringBuilder sb=new StringBuilder();
    sb.append("Act/Prd\t");
    for (    String s : pdomain)     if (s != null)     sb.append(s).append('\t');
    sb.append("Error\n");
    long terr=0;
    for (int a=0; a < cm.length; a++) {
      if (adomain[a] == null)       continue;
      sb.append(adomain[a]).append('\t');
      long correct=0;
      for (int p=0; p < pdomain.length; p++) {
        if (pdomain[p] == null)         continue;
        if (adomain[a].equals(pdomain[p]))         correct=cm[a][p];
        sb.append(cm[a][p]).append('\t');
      }
      long err=acts[a] - correct;
      terr+=err;
      sb.append(String.format("%5.3f = %d / %d\n",(double)err / acts[a],err,acts[a]));
    }
    sb.append("Totals\t");
    for (int p=0; p < pdomain.length; p++)     if (pdomain[p] != null)     sb.append(preds[p]).append("\t");
    sb.append(String.format("%5.3f = %d / %d\n",(double)terr / CM.vactual.length(),terr,CM.vactual.length()));
    System.out.println(sb);
  }
  finally {
    gbm.source.delete();
    if (ftest != null)     ftest.delete();
    if (fpreds != null)     fpreds.delete();
    if (gbmmodel != null)     gbmmodel.delete();
    UKV.remove(gbm.response._key);
    gbm.remove();
  }
}
