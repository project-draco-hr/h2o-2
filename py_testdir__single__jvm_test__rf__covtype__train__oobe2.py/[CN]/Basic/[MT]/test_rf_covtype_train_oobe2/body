def test_rf_covtype_train_oobe2(self):
    print '\nUse randomBitVector and filter to separate the dataset randomly'
    importFolderPath = '/home/0xdiag/datasets/standard'
    csvFilename = 'covtype.data'
    csvPathname = ((importFolderPath + '/') + csvFilename)
    key2 = (csvFilename + '.hex')
    h2i.setupImportFolder(None, importFolderPath)
    print '\nUsing header=0 on the normal covtype.data'
    parseKey = h2i.parseImportFolderFile(None, csvFilename, importFolderPath, key2=key2, header=0, timeoutSecs=100)
    inspect = h2o_cmd.runInspect(None, parseKey['destination_key'])
    print ('\n' + csvPathname), '    num_rows:', '{:,}'.format(inspect['num_rows']), '    num_cols:', '{:,}'.format(inspect['num_cols'])
    num_rows = inspect['num_rows']
    pct10 = int((num_rows * 0.1))
    rowsForPct = [(i * pct10) for i in range(0, 11)]
    last10 = (num_rows - rowsForPct[9])
    rowsForPct[10] = last10
    rowsForPct[0] = rowsForPct[10]
    expectTrainPctRightList = [0, 85.16, 88.45, 90.24, 91.27, 92.03, 92.64, 93.11, 93.48, 93.79]
    expectScorePctRightList = [0, 88.81, 91.72, 93.06, 94.02, 94.52, 95.09, 95.41, 95.77, 95.78]
    print 'Creating the key of the last 10% data, for scoring'
    dataKeyTest = 'rTest'
    dataKeyTrain = 'rTrain'
    execExpr = (((('rbv=randomBitVector(' + str(num_rows)) + ',') + str(last10)) + ',12345)')
    h2o_exec.exec_expr(None, execExpr, resultKey='rbv', timeoutSecs=10)
    execExpr = 'not_rbv=colSwap(rbv,0,rbv[0]==0?1:0)'
    h2o_exec.exec_expr(None, execExpr, resultKey='not_rbv', timeoutSecs=10)
    execExpr = (((dataKeyTest + '=filter(') + key2) + ',rbv)')
    h2o_exec.exec_expr(None, execExpr, resultKey=dataKeyTest, timeoutSecs=10)
    execExpr = (((dataKeyTrain + '=filter(') + key2) + ',not_rbv)')
    h2o_exec.exec_expr(None, execExpr, resultKey=dataKeyTrain, timeoutSecs=10)
    actualTrainPctRightList = [0]
    actualScorePctRightList = [0]
    for trial in range(1, 10):
        rowsToUse = rowsForPct[(trial % 10)]
        resultKey = ('r' + str(trial))
        execExpr = (((((resultKey + '=slice(') + dataKeyTrain) + ',1,') + str(rowsToUse)) + ')')
        h2o_exec.exec_expr(None, execExpr, resultKey=resultKey, timeoutSecs=10)
        parseKey['destination_key'] = resultKey
        kwargs = paramDict.copy()
        timeoutSecs = (30 + (kwargs['ntree'] * 20))
        start = time.time()
        kwargs['out_of_bag_error_estimate'] = 1
        kwargs['model_key'] = ('model_' + str(trial))
        rfv = h2o_cmd.runRFOnly(parseKey=parseKey, timeoutSecs=timeoutSecs, **kwargs)
        elapsed = (time.time() - start)
        print 'RF end on ', csvPathname, 'took', elapsed, 'seconds.', ('%d pct. of timeout' % ((elapsed / timeoutSecs) * 100))
        oobeTrainPctRight = (100 * (1.0 - rfv['confusion_matrix']['classification_error']))
        self.assertAlmostEqual(oobeTrainPctRight, expectTrainPctRightList[trial], msg=('OOBE: pct. right for %s pct. training not close enough %6.2f %6.2f' % ((trial * 10), oobeTrainPctRight, expectTrainPctRightList[trial])), delta=0.2)
        actualTrainPctRightList.append(oobeTrainPctRight)
        print 'Now score on the last 10%'
        model_key = rfv['model_key']
        kwargs.pop('model_key', None)
        data_key = rfv['data_key']
        kwargs.pop('data_key', None)
        ntree = rfv['ntree']
        kwargs.pop('ntree', None)
        kwargs['iterative_cm'] = 1
        kwargs['out_of_bag_error_estimate'] = 0
        rfv = h2o_cmd.runRFView(None, dataKeyTest, model_key, ntree, timeoutSecs, retryDelaySecs=1, print_params=True, **kwargs)
        h2o.nodes[0].generate_predictions(model_key=model_key, key=dataKeyTest)
        fullScorePctRight = (100 * (1.0 - rfv['confusion_matrix']['classification_error']))
        self.assertAlmostEqual(fullScorePctRight, expectScorePctRightList[trial], msg=('Full: pct. right for scoring after %s pct. training not close enough %6.2f %6.2f' % ((trial * 10), fullScorePctRight, expectScorePctRightList[trial])), delta=0.2)
        actualScorePctRightList.append(fullScorePctRight)
        print 'Trial #', trial, 'completed', ('using %6.2f' % ((rowsToUse * 100.0) / num_rows)), 'pct. of all rows'
    actualDelta = [abs((a - b)) for (a, b) in zip(expectTrainPctRightList, actualTrainPctRightList)]
    niceFp = ['{0:0.2f}'.format(i) for i in actualTrainPctRightList]
    print 'maybe should update with actual. Remove single quotes'
    print 'actualTrainPctRightList =', niceFp
    niceFp = ['{0:0.2f}'.format(i) for i in actualDelta]
    print 'actualDelta =', niceFp
    actualDelta = [abs((a - b)) for (a, b) in zip(expectScorePctRightList, actualScorePctRightList)]
    niceFp = ['{0:0.2f}'.format(i) for i in actualScorePctRightList]
    print 'maybe should update with actual. Remove single quotes'
    print 'actualScorePctRightList =', niceFp
    niceFp = ['{0:0.2f}'.format(i) for i in actualDelta]
    print 'actualDelta =', niceFp
