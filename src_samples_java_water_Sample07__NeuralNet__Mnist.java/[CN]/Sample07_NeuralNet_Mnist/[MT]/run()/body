{
  Vec[] train=TestUtil.parseFrame("smalldata/mnist/train.csv.gz").vecs();
  Vec[] test=TestUtil.parseFrame("smalldata/mnist/test.csv.gz").vecs();
  NeuralNet.reChunk(train);
  Vec trainLabels=train[train.length - 1];
  trainLabels.asEnum();
  train=Utils.remove(train,train.length - 1);
  Vec testLabels=test[test.length - 1];
  test=Utils.remove(test,test.length - 1);
  Layer[] ls=build(train,trainLabels,null);
  Trainer trainer=new Trainer.MapReduce(ls);
  trainer.start();
  long start=System.nanoTime();
  long lastTime=start;
  long lastItems=0;
  for (; ; ) {
    try {
      Thread.sleep(2000);
    }
 catch (    InterruptedException e) {
      throw new RuntimeException(e);
    }
    long time=System.nanoTime();
    double delta=(time - lastTime) / 1e9;
    double total=(time - start) / 1e9;
    long steps=trainer.items();
    int ps=(int)((steps - lastItems) / delta);
    String text=(int)total + "s, " + steps+ " steps ("+ (ps)+ "/s) ";
    lastTime=time;
    lastItems=steps;
    Layer[] temp=build(train,trainLabels,(VecsInput)ls[0]);
    Layer.copyWeights(ls,temp);
    Error error=NeuralNetScore.run(temp,NeuralNet.EVAL_ROW_COUNT,null);
    text+="train: " + error;
    temp=build(test,testLabels,(VecsInput)ls[0]);
    Layer.copyWeights(ls,temp);
    error=NeuralNetScore.run(temp,NeuralNet.EVAL_ROW_COUNT,null);
    text+=", test: " + error;
    System.out.println(text);
  }
}
