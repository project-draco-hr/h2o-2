{
  final int CLASSES=3;
  Key fkey=load_test_file("smalldata/iris/iris2.csv");
  Key okey=Key.make("iris.hex");
  ParseDataset.parse(okey,DKV.get(fkey));
  UKV.remove(fkey);
  DKV.get(okey);
  final int NTREE=7;
  try {
    Properties p=new Properties();
    p.setProperty("Key",okey.toString());
    p.setProperty("ntree",Integer.toString(NTREE));
    p.setProperty("sample",Integer.toString(67));
    p.setProperty("OOBEE","true");
    RandomForestPage RFP=new RandomForestPage();
    JsonObject res=RFP.serverJson(null,p,null);
    Key modelKey=Key.make(res.get("modelKey").getAsString());
    RFModel model=new RFModel();
    int ntree=res.get("ntree").getAsInt();
    assertEquals(ntree,NTREE);
    while (true) {
      model=UKV.get(modelKey,model);
      if (model.size() >= ntree)       break;
      try {
        Thread.sleep(100);
      }
 catch (      InterruptedException ie) {
      }
    }
    assertEquals(CLASSES,model.classes());
    p.setProperty("dataKey",okey.toString());
    p.setProperty("modelKey",modelKey.toString());
    p.setProperty("ntree",Integer.toString(ntree));
    p.setProperty("atree",Integer.toString(ntree));
    RFView rfv=new RFView();
    JsonObject rfv_res=rfv.serverJson(null,p,null);
    rfv.serveImpl(null,p,null);
    Key oKey2=Key.make(rfv_res.get("dataKey").getAsString());
    assertEquals(okey,oKey2);
    Key mkey2=Key.make(rfv_res.get("modelKey").getAsString());
    assertEquals(modelKey,mkey2);
    Key confKey=Key.make(rfv_res.get("confusionKey").getAsString());
    Confusion C=UKV.get(confKey,new Confusion());
    for (    long[] x : C._matrix) {
      for (      long y : x)       System.out.print(" " + y);
      System.out.println();
    }
    long ans[][]=new long[][]{{45,1,0},{0,41,6},{0,3,43}};
    for (int i=0; i < ans.length; i++)     for (int j=0; j < ans[i].length; j++)     assertEquals(ans[i][j],C._matrix[i][j]);
    UKV.get(modelKey,new RFModel()).deleteKeys();
    UKV.remove(modelKey);
    UKV.remove(confKey);
  }
 catch (  water.web.Page.PageError pe) {
    fail("RandomForestPage fails with " + pe);
  }
 finally {
    UKV.remove(okey);
  }
}
