{
  final NNModel model=UKV.get(dest());
  final Frame[] valid_adapted=validation == null ? null : model.adapt(validation,false);
  Frame train=_dinfo._adaptedFrame;
  Frame valid=validation == null ? null : valid_adapted[0];
  Frame trainScoreFrame=sampleFrame(train,score_training_samples,seed);
  Frame validScoreFrame=sampleFrame(valid,score_validation_samples,seed + 1);
  if (sync_samples > train.numRows()) {
    Log.warn("Setting sync_samples (" + sync_samples + ") to the number of rows of the training data ("+ (sync_samples=train.numRows())+ ").");
  }
  final float sync_fraction=sync_samples == 0l ? 1.0f : (float)sync_samples / train.numRows();
  Log.info("Starting to train the Neural Net model.");
  long timeStart=System.currentTimeMillis();
  do {
    NNTask nntask=new NNTask(_dinfo,model.model_info(),true,sync_fraction,shuffle_training_data).doAll(train);
    model.set_model_info(nntask.model_info());
  }
 while (model.doDiagnostics(trainScoreFrame,validScoreFrame,timeStart,self()));
  model.unlock(self());
  source.unlock(self());
  if (validation != null && !source._key.equals(validation._key))   validation.unlock(self());
  if (validScoreFrame != null && validScoreFrame != valid)   validScoreFrame.delete();
  if (trainScoreFrame != null && trainScoreFrame != train)   trainScoreFrame.delete();
  if (validation != null)   valid_adapted[1].delete();
  UKV.remove(self());
  Log.info("Neural Net training finished.");
  return model;
}
