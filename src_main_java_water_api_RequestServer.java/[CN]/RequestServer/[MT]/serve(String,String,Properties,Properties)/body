{
  Thread.currentThread().setPriority(Thread.MAX_PRIORITY - 1);
  uri=maybeTransformRequest(uri);
  Request.RequestType type=Request.RequestType.requestType(uri);
  String requestName=type.requestName(uri);
  maybeLogRequest(uri,method,parms);
  AbstractHandler handler=getRoute(uri);
  if (null != handler) {
    if ("get".equalsIgnoreCase(method)) {
      return handler.get(this,uri,header,parms);
    }
 else     if ("post".equalsIgnoreCase(method)) {
      return handler.post(this,uri,header,parms);
    }
 else     if ("put".equalsIgnoreCase(method)) {
      return handler.put(this,uri,header,parms);
    }
 else     if ("delete".equalsIgnoreCase(method)) {
      return handler.delete(this,uri,header,parms);
    }
 else {
      Log.warn("Unknown http method, request ignored: " + method);
      return _http500.serve(this,parms,type);
    }
  }
 else {
    try {
      Request request=_requests.get(requestName);
      if (request == null)       return getResource(uri);
      request=request.create(parms);
      return request.serve(this,parms,type);
    }
 catch (    Exception e) {
      if (!(e instanceof ExpectedExceptionForDebug))       e.printStackTrace();
      parms.setProperty(Request.ERROR,e.getClass().getSimpleName() + ": " + e.getMessage());
      return _http500.serve(this,parms,type);
    }
  }
}
