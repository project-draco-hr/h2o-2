{
  if (resKey == null)   resKey=PCAModel.makeKey();
  GramMatrixFunc gramF=new GramMatrixFunc(data,new GLMParams(Family.gaussian),null);
  Gram gram=gramF.apply(job,data);
  Matrix myGram=new Matrix(gram.getXX());
  int nfeat=myGram.getRowDimension();
  SingularValueDecomposition mySVD=myGram.svd();
  double[] Sval=mySVD.getSingularValues();
  int ncomp=getNumPC(Sval,params._tol);
  double[] sdev=new double[ncomp];
  double totVar=0;
  for (int i=0; i < ncomp; i++) {
    sdev[i]=Math.sqrt(Sval[i]);
    totVar+=Sval[i];
  }
  Matrix eigV=mySVD.getV();
  double[][] eigVec=eigV.getMatrix(0,nfeat - 1,0,ncomp - 1).transpose().getArray();
  double[] propVar=new double[ncomp];
  for (int i=0; i < ncomp; i++) {
    propVar[i]=Sval[i] / totVar;
  }
  PCAModel myModel=new PCAModel(Status.Done,0.0f,resKey,data,sdev,propVar,eigVec,0,ncomp,params);
  myModel.store();
  return myModel;
}
