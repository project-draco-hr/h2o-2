{
  fr.add("OUT_BAG_TREES",response.makeZero());
  DRFModel model=new DRFModel(outputKey,dataKey,validation == null ? null : testKey,names,domains,ntrees,max_depth,min_rows,nbins,mtries,sample_rate,_seed);
  model.delete_and_lock(self());
  Random rand=createRNG(_seed);
  new SetWrkTask().doAll(fr);
  int tid;
  DTree[] ktrees=null;
  TreeStats tstats=new TreeStats();
  for (tid=0; tid < ntrees; tid++) {
    model=doScoring(model,outputKey,fr,ktrees,tid,tstats,tid == 0,validation == null,build_tree_per_node);
    ktrees=buildNextKTrees(fr,_mtry,sample_rate,rand);
    Log.info(Sys.DRF__,(tid + 1) + ". tree was built.");
    if (!Job.isRunning(self()))     break;
    tstats.updateBy(ktrees);
  }
  model=doScoring(model,outputKey,fr,ktrees,tid,tstats,true,validation == null,build_tree_per_node);
  if (classification && importance) {
    model=doVarImp(model,fr);
    Log.info(Sys.DRF__,"Var. importance: " + Arrays.toString(model.varimp));
  }
  model.unlock(self());
  cleanUp(fr,t_build);
}
