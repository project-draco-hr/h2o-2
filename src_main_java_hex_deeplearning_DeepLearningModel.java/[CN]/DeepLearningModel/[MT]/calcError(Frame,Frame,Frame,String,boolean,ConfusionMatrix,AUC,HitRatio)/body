{
  StringBuilder sb=new StringBuilder();
  double error;
  if (auc != null) {
    auc.actual=ftest;
    auc.vactual=ftest.lastVec();
    auc.predict=fpreds;
    auc.vpredict=fpreds.vecs()[2];
    auc.threshold_criterion=AUC.ThresholdCriterion.maximum_F1;
    auc.invoke();
    auc.toASCII(sb);
    error=auc.err();
  }
 else {
    if (cm == null)     cm=new ConfusionMatrix();
    cm.actual=ftest;
    cm.vactual=ftest.lastVec();
    cm.predict=fpreds;
    cm.vpredict=fpreds.vecs()[0];
    cm.invoke();
    cm.toASCII(sb);
    error=isClassifier() ? new hex.ConfusionMatrix(cm.cm).err() : cm.mse;
  }
  if (hr != null) {
    hr.actual=ftest;
    hr.vactual=ftest.lastVec();
    hr.predict=hitratio_fpreds;
    hr.serve();
    hr.toASCII(sb);
  }
  if (printCM && (auc != null || cm.cm == null || cm.cm.length <= model_info().get_params().max_confusion_matrix_size)) {
    Log.info("Scoring on " + label + " data:");
    for (    String s : sb.toString().split("\n"))     Log.info(s);
  }
  return error;
}
