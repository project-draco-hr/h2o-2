{
  String query=checkArguments(parms,type);
switch (type) {
case help:
    return wrap(server,HTMLHelp());
case json:
case www:
  if (log()) {
    String log=getClass().getSimpleName();
    for (    Object arg : parms.keySet()) {
      String value=parms.getProperty((String)arg);
      if (value != null && value.length() != 0)       log+=" " + arg + "="+ value;
    }
    Log.debug(Sys.HTTPD,log);
  }
if (query != null) return wrap(server,query,type);
long time=System.currentTimeMillis();
Response response=serveGrid();
response.setTimeStart(time);
if (type == RequestType.json) return response._req == null ? wrap(server,response.toJson()) : wrap(server,new String(response._req.writeJSON(new AutoBuffer()).buf()),RequestType.json);
return wrap(server,build(response));
case query:
return wrap(server,query);
default :
throw new RuntimeException("Invalid request type " + type.toString());
}
}
